@startuml Diagrama de Secuencia - Votar Comentario
actor Usuario
participant "ComentarioController" as ComentarioController
participant "EntityManagerInterface" as EM
participant "VotoComentarioRepository" as VotoComentarioRepo

Usuario -> ComentarioController : POST /comentario/{id}/votar\nvotarComentario(id, Request, EM)
activate ComentarioController
ComentarioController -> ComentarioController : getUser()
alt not authenticated
ComentarioController --> Usuario : redirect(app_iniciar_sesion)
else authenticated
ComentarioController -> EM : getRepository(Comentario::class)->find(id)
activate EM
EM --> ComentarioController : Comentario
deactivate EM
ComentarioController -> VotoComentarioRepo : findOneBy(['usuario'=>$user,'comentario'=>$comentario])
activate VotoComentarioRepo
VotoComentarioRepo --> ComentarioController : voto|null
deactivate VotoComentarioRepo
alt voto existe
ComentarioController -> ComentarioController : setValor(...)
else
ComentarioController -> EM : persist(VotoComentario)
activate EM
EM --> ComentarioController : ok
ComentarioController -> EM : flush()
EM --> ComentarioController : ok
deactivate EM
end
ComentarioController --> Usuario : redirect(app_pagina_noticia)
end
deactivate ComentarioController
@enduml