{% extends 'base.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('css/noticia.css') }}">
{% endblock %}

{% block body %}
<main class="noticia-container">

    <!-- Encabezado de la noticia -->
    <section class="noticia-header">
        <img src="{{ asset('images/' ~ noticia.imagen) }}" alt="{{ noticia.titulo }}">
        <div class="noticia-titulos">
            <h1>{{ noticia.titulo }}</h1>
            <h2>{{ noticia.subtitulo }}</h2>
            <small class="noticia-fecha">{{ noticia.fechaPublicacion|date('d M Y') }}</small>
        </div>
        <p class="noticia-cuerpo">{{ noticia.cuerpo }}</p>
    </section>

    <!-- Votaci√≥n -->
    <section class="votar-noticia">
        <form method="post" action="{{ path('noticia_votar', {id: noticia.id}) }}">
            <label>Califica esta noticia:</label>
            <div class="estrellas">
                {% for i in 1..5 %}
                    <label>
                        <input type="radio" name="puntuacion" value="{{ i }}"> {{ i }} ‚≠ê
                    </label>
                {% endfor %}
            </div>
            <button type="submit">Votar</button>
        </form>
        <p class="promedio-texto">Promedio: {{ noticia.promedioVotos }} / 5</p>
        <div class="promedio-bar">
            <div class="promedio-fill" style="width: {{ (noticia.promedioVotos/5)*100 }}%;"></div>
        </div>
    </section>

    <!-- Comentarios -->
    <section class="comentarios-section">
        <h3>Comentarios</h3>
        {% if app.user %}
            <form action="{{ path('agregar_comentario', {id: noticia.id}) }}" method="post" class="form-comentario">
                <textarea name="contenido" rows="4" placeholder="Escribe tu comentario..." required></textarea>
                <button type="submit">Enviar</button>
            </form>
        {% else %}
            <p class="comentario-login">Usuario no autenticado. Inicia sesi√≥n para dejar un comentario.</p>
            <a href="{{ path('app_iniciar_sesion') }}"><button class="btn-login">Iniciar sesi√≥n</button></a>
        {% endif %}
    </section>

    <!-- Lista de comentarios -->
    <section class="comentarios-list">
        <h4>Comentarios existentes:</h4>
        {% if noticia.comentarios is empty %}
            <p>No hay comentarios a√∫n. S√© el primero en comentar!</p>
        {% else %}
            {% for comentario in noticia.comentarios %}
                <div class="comentario-card">
                    <p><strong>{{ comentario.usuario.nombreUsuario }}</strong></p>
                    <p>{{ comentario.contenido }}</p>
                    <div class="comentario-actions">
                        <a href="{{ path('votar_comentario', {id: comentario.id, valor: 1}) }}">
                            <button>üëç {{ comentario.votoComentarios|filter(v => v.valor)|length }}</button>
                        </a>
                        <a href="{{ path('votar_comentario', {id: comentario.id, valor: 0}) }}">
                            <button>üëé {{ comentario.votoComentarios|filter(v => not v.valor)|length }}</button>
                        </a>
                        <a href="{{ path('comentario_denunciar', {id: comentario.id}) }}" class="btn-reportar">Reportar</a>
                    </div>
                </div>
            {% endfor %}
        {% endif %}
    </section>

</main>
{% endblock %}
